<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - Manajemen Jadwal Kuliah</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body class="bg-gray-100 flex items-center justify-center h-screen">
  <div class="bg-white shadow-lg rounded-xl p-8 w-full max-w-md">
    <h1 class="text-2xl font-bold text-center mb-6">📚 Manajemen Jadwal Kuliah</h1>

    <div id="loginForm">
      <h2 class="text-lg font-semibold mb-2">Masuk</h2>
      <input id="loginEmail" type="email" placeholder="Email" class="w-full border p-2 rounded mb-2">
      <input id="loginPassword" type="password" placeholder="Password" class="w-full border p-2 rounded mb-4">
      <button onclick="loginUser()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Login</button>
      <p class="text-sm mt-3 text-center">
        Belum punya akun? <a href="#" onclick="showRegister()" class="text-blue-600 hover:underline">Daftar di sini</a>
      </p>
    </div>

    <div id="registerForm" class="hidden">
      <h2 class="text-lg font-semibold mb-2">Daftar Akun Baru</h2>
      <input id="regEmail" type="email" placeholder="Email" class="w-full border p-2 rounded mb-2">
      <input id="regPassword" type="password" placeholder="Password (Min 6 Karakter)" class="w-full border p-2 rounded mb-4">
      <button onclick="registerUser()" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">Daftar</button>
      <p class="text-sm mt-3 text-center">
        Sudah punya akun? <a href="#" onclick="showLogin()" class="text-blue-600 hover:underline">Masuk</a>
      </p>
    </div>
  </div>
  
  <div id="toast-container" class="fixed bottom-4 right-4 space-y-2 z-50">
      </div>


  <script>
    // --- FUNGSI TOAST BARU ---
    function showToast(message, type = 'success') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        
        let baseClasses = "p-4 rounded-lg shadow-xl text-white transition-all duration-500 transform";
        let icon = '';

        if (type === 'success') {
            baseClasses += " bg-green-500";
            icon = '✅';
        } else if (type === 'error') {
            baseClasses += " bg-red-600";
            icon = '❌';
        } else if (type === 'info') {
            baseClasses += " bg-blue-500";
            icon = 'ℹ️';
        }

        toast.className = baseClasses + " opacity-0 translate-y-2";
        toast.innerHTML = `${icon} ${message}`;
        
        container.appendChild(toast);

        // Show animation
        setTimeout(() => {
            toast.classList.remove('opacity-0', 'translate-y-2');
            toast.classList.add('opacity-100', 'translate-y-0');
        }, 10);

        // Auto-hide and remove after 3 seconds
        setTimeout(() => {
            // Hide animation
            toast.classList.remove('opacity-100', 'translate-y-0');
            toast.classList.add('opacity-0', 'translate-y-2');
            
            // Remove element after transition
            setTimeout(() => {
                if(container.contains(toast)) {
                    container.removeChild(toast);
                }
            }, 500); 
        }, 3000); 
    }


    // --- Supabase setup ---
    const SUPABASE_URL = "https://bnslruddgegoeexbjwgr.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJuc2xydWRkZ2Vnb2VleGJqd2dyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4ODkyMTMsImV4cCI6MjA3NTQ2NTIxM30.V50LK0cosSOdZEpU96A5CM41vzapQJoB1MvJkPQE03o";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // --- FUNGSI TAMPILAN (Tidak Berubah) ---
    function showRegister() {
      document.getElementById('loginForm').classList.add('hidden');
      document.getElementById('registerForm').classList.remove('hidden');
    }

    function showLogin() {
      document.getElementById('registerForm').classList.add('hidden');
      document.getElementById('loginForm').classList.remove('hidden');
    }


    // --- LOGIN (Menggunakan showToast) ---
    async function loginUser() {
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value.trim();

      if (!email || !password) {
        showToast("Email dan password wajib diisi!", 'error'); // Ganti alert
        return;
      }
      
      const { error } = await supabaseClient.auth.signInWithPassword({ email, password });

      if (error) {
        showToast("Login gagal: " + error.message, 'error'); // Ganti alert
        console.error(error);
      } else {
        showToast("Login berhasil! Mengalihkan...", 'success'); // Ganti alert
        // Beri waktu toast muncul sebentar sebelum redirect
        setTimeout(() => {
             window.location.href = "main.html";
        }, 500);
      }
    }

    // --- REGISTER (Menggunakan showToast) ---
    async function registerUser() {
      const email = document.getElementById("regEmail").value.trim();
      const password = document.getElementById("regPassword").value.trim();

      if (!email || !password) {
        showToast("Email dan password wajib diisi!", 'error'); // Ganti alert
        return;
      }
      if (password.length < 6) {
        showToast("Password minimal 6 karakter!", 'error'); // Ganti alert
        return;
      }

      try {
        const { data, error } = await supabaseClient.auth.signUp(
          { email, password },
          { emailRedirectTo: null } 
        );

        if (error) {
          showToast("Gagal membuat akun: " + error.message, 'error'); // Ganti alert
          console.error(error);
          return;
        }

        showToast("Akun berhasil dibuat! Anda akan langsung masuk ke sistem. Mengalihkan...", 'success'); // Ganti alert
        setTimeout(() => {
             window.location.href = "main.html";
        }, 500);

      } catch (err) {
        console.error(err);
        showToast("Terjadi kesalahan koneksi ke Supabase.", 'error'); // Ganti alert
      }
    }

    // --- CEK LOGIN SAAT MASUK HALAMAN (Tidak Berubah) ---
    window.onload = async () => {
      const { data } = await supabaseClient.auth.getUser();
      if (data?.user) {
        window.location.href = "main.html";
      }
    };
  </script>
</body>
</html>
