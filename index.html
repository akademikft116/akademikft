// --- Fungsi Login ---
async function login() {
    const username = document.getElementById("login-username").value.trim();
    const password = document.getElementById("login-password").value;

    if (!username || !password) {
        alert("Username dan Password harus diisi!");
        return;
    }

    // 1. Cek username dan dapatkan email dummy (Logika lama Anda)
    const { data: metadata, error: metadataError } = await supabaseClient
        .from('users_metadata')
        .select('email')
        .eq('username', username)
        .single();

    if (metadataError || !metadata) {
        alert("❌ Login gagal: Username tidak ditemukan.");
        console.error(metadataError);
        return;
    }

    const authEmail = metadata.email;

    // 2. Lakukan login di Supabase Auth
    const { error } = await supabaseClient.auth.signInWithPassword({ 
        email: authEmail, 
        password: password 
    });
    
    if (error) {
        alert("❌ Login gagal: Periksa kembali password Anda.");
        console.error(error);
    } else {
        alert("✅ Login Berhasil!");
        // MODIFIKASI: Redirect ke dashboard.html
        window.location.href = "dashboard.html"; 
    }
}

// --- Fungsi Register ---
async function handleRegister() {
    // ... (Logika validasi register lama Anda) ...

    // MODIFIKASI: Redirect ke dashboard.html setelah pendaftaran berhasil
    alert("✅ Akun berhasil dibuat! Anda akan langsung masuk ke sistem.");
    window.location.href = "dashboard.html"; 
}

// --- CEK LOGIN SAAT MASUK HALAMAN ---
window.onload = async () => {
  const { data } = await supabaseClient.auth.getUser();
  if (data?.user) {
    // MODIFIKASI: Redirect ke dashboard.html jika sudah login
    window.location.href = "dashboard.html";
  }
};
