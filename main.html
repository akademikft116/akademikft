<!DOCTYPE html>
<html lang="id" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Jadwal Kuliah</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        /* Styling untuk Dark Mode dan Tom-Select */
        .dark .bg-white { background-color: #1f2937; } 
        .dark .text-gray-900 { color: #f9fafb; } 
        .dark .bg-gray-100 { background-color: #111827; } 
        .sidebar { transition: width 0.3s; }
        .dark .sidebar { background-color: #1f2937; }
        .ts-wrapper.dark .ts-control {
            background-color: #374151; /* bg-gray-700 */
            color: #f3f4f6; /* text-gray-100 */
            border-color: #4b5563; /* border-gray-600 */
        }
        .ts-wrapper.dark .option, .ts-wrapper.dark .item {
            background-color: #374151;
            color: #f3f4f6;
        }
    </style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 min-h-screen text-gray-900 dark:text-gray-50">

    <aside id="sidebar" class="sidebar fixed top-0 left-0 w-64 h-full bg-white dark:bg-gray-800 shadow-xl z-30 flex flex-col">
        
        <div class="p-6 flex items-center justify-center border-b border-gray-200 dark:border-gray-700">
            <img src="logo.jpeg" alt="Logo" class="w-10 h-10 rounded-full mr-3">
            <h1 class="text-xl font-bold text-blue-600 dark:text-blue-400">Akademik FT</h1>
        </div>
        
        <nav class="flex-grow p-4 space-y-2">
            <a href="dashboard.html" class="flex items-center p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition duration-150">
                <i class="fas fa-home w-5 h-5 mr-3"></i>
                Dashboard
            </a>
            <a href="main.html" class="flex items-center p-3 rounded-lg bg-blue-100 dark:bg-blue-600 text-blue-700 dark:text-white font-semibold transition duration-150">
                <i class="fas fa-calendar-alt w-5 h-5 mr-3"></i>
                Penjadwalan
            </a>
        </nav>

        <div class="p-4 border-t border-gray-200 dark:border-gray-700 space-y-4">
            <div class="flex items-center justify-between">
                <label for="theme-switcher" class="block text-sm font-medium">Tema Tampilan:</label>
                <select id="theme-switcher" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-1.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <option value="system">Sistem</option>
                    <option value="light">Terang</option>
                    <option value="dark">Gelap</option>
                </select>
            </div>
            <button onclick="logout()" class="w-full bg-red-600 text-white p-2 rounded-lg hover:bg-red-700 transition duration-150">
                <i class="fas fa-sign-out-alt mr-2"></i>
                Logout
            </button>
        </div>
    </aside>

    <div class="ml-64 p-6 transition-all duration-300">
        
        <header class="flex items-center justify-between p-4 bg-white dark:bg-gray-800 shadow-md rounded-lg mb-6">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-100">Tambah / Ubah Jadwal Kuliah</h2>
            <div class="flex items-center space-x-4">
                <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">A</div>
            </div>
        </header>

        <section class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg mb-6">
            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-100" id="form-title">Tambah Jadwal Baru</h3>
            <form id="jadwal-form" class="space-y-4">
                <input type="hidden" id="jadwal-id">
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label for="prodi" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Program Studi</label>
                        <select id="prodi" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <option value="">-- Pilih Prodi --</option>
                            <option value="Teknik Industri">Teknik Industri</option>
                            <option value="Teknik Sipil">Teknik Sipil</option>
                            <option value="Teknik Arsitektur">Teknik Arsitektur</option>
                            <option value="Teknik Elektro">Teknik Elektro</option>
                            <option value="Teknik Informatika">Teknik Informatika</option>
                        </select>
                    </div>
                    <div>
                        <label for="semester" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Semester</label>
                        <input type="number" id="semester" required placeholder="Contoh: 3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>
                    <div>
                        <label for="kelas" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Kelas</label>
                        <input type="text" id="kelas" required placeholder="Contoh: A/B" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>
                    <div>
                        <label for="tahun_akademik" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Tahun Akademik</label>
                        <input type="text" id="tahun_akademik" required placeholder="Contoh: 2024/2025" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>

                    <div class="col-span-2">
                        <label for="mata_kuliah" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Mata Kuliah</label>
                        <select id="mata_kuliah" required class="mt-1 block w-full" placeholder="Pilih atau Ketik Mata Kuliah"></select>
                    </div>
                    <div>
                        <label for="sks" class="block text-sm font-medium text-gray-700 dark:text-gray-300">SKS</label>
                        <input type="number" id="sks" required placeholder="Contoh: 3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>
                    <div>
                        <label for="ruangan" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Ruangan</label>
                        <input type="text" id="ruangan" required placeholder="Contoh: R-101" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>

                    <div class="col-span-2">
                        <label for="dosen" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Dosen Pengampu</label>
                        <select id="dosen" required class="mt-1 block w-full" placeholder="Pilih atau Ketik Dosen"></select>
                    </div>
                    <div class="col-span-2">
                        <label for="asisten" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Asisten Dosen (Opsional)</label>
                        <select id="asisten" class="mt-1 block w-full" placeholder="Pilih atau Ketik Asisten"></select>
                    </div>

                    <div>
                        <label for="hari" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Hari</label>
                        <select id="hari" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <option value="">-- Pilih Hari --</option>
                            <option value="Senin">Senin</option>
                            <option value="Selasa">Selasa</option>
                            <option value="Rabu">Rabu</option>
                            <option value="Kamis">Kamis</option>
                            <option value="Jumat">Jumat</option>
                            <option value="Sabtu">Sabtu</option>
                        </select>
                    </div>
                    <div>
                        <label for="jam_mulai" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Jam Mulai</label>
                        <input type="time" id="jam_mulai" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>
                    <div>
                        <label for="jam_akhir" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Jam Akhir</label>
                        <input type="time" id="jam_akhir" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>
                </div>

                <div class="mt-4 flex justify-end space-x-3">
                    <button type="button" id="cancel-btn" class="secondary-btn bg-gray-500 hover:bg-gray-600 text-white p-2 rounded-lg hidden">Batal</button>
                    <button type="submit" id="submit-btn" class="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-lg">Simpan Jadwal</button>
                </div>
            </form>
        </section>

        <section class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg mb-6">
            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-100">Filter dan Export Data</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <div>
                    <label for="filterProdi" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Filter Prodi</label>
                    <select id="filterProdi" onchange="filterData()" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <option value="">Semua Prodi</option>
                        <option value="Teknik Industri">Teknik Industri</option>
                        <option value="Teknik Sipil">Teknik Sipil</option>
                        <option value="Teknik Arsitektur">Teknik Arsitektur</option>
                        <option value="Teknik Elektro">Teknik Elektro</option>
                        <option value="Teknik Informatika">Teknik Informatika</option>
                    </select>
                </div>
                </div>
            
            <div class="flex space-x-3 justify-end">
                <button onclick="exportExcel()" class="export-btn bg-green-600 hover:bg-green-700 text-white p-2 rounded-lg">
                    <i class="fas fa-file-excel mr-2"></i>Export Excel
                </button>
                <button onclick="exportPDF()" class="export-btn bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg">
                    <i class="fas fa-file-pdf mr-2"></i>Export PDF
                </button>
            </div>
        </section>

        <section class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg">
            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-100">Daftar Jadwal Kuliah</h3>
            <div class="overflow-x-auto">
                <table id="tabelJadwal" class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead>
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">No</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Prodi</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Sms/Kls</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Matkul (SKS)</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Dosen/Asisten</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Waktu/Ruangan</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Aksi</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                        <tr><td colspan="7" class="text-center py-4 text-gray-500">Memuat data...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

    </div>

    <script>
        // --- Inisialisasi Supabase ---
        const SUPABASE_URL = "https://bnslruddgegoeexbjwgr.supabase.co"; 
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJuc2xydWRkZ2Vnb2VleGJqd2dyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4ODkyMTMsImV4cCI6MjA3NTQ2NTIxM30.V50LK0cosSOdZEpU96A5CM41vzapQJoB1MvJkPQE03o"; 
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // --- FUNGSI THEME SWITCHER & LOGOUT ---
        function setTheme(theme) {
            const html = document.documentElement;
            const switcher = document.getElementById('theme-switcher');
            if (switcher && switcher.value !== theme) { switcher.value = theme; }
            html.classList.remove('light', 'dark');
            const tsWrappers = document.querySelectorAll('.ts-wrapper');
            tsWrappers.forEach(wrap => { wrap.classList.remove('dark'); });

            if (theme === 'dark') { 
                html.classList.add('dark'); 
                tsWrappers.forEach(wrap => { wrap.classList.add('dark'); });
            } 
            else if (theme === 'light') { html.classList.add('light'); } 
            else { 
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    html.classList.add('dark');
                    tsWrappers.forEach(wrap => { wrap.classList.add('dark'); });
                } else {
                    html.classList.add('light');
                }
            }
        }
        function applyTheme() {
            const savedTheme = localStorage.getItem('theme') || 'system';
            setTheme(savedTheme);
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                if (localStorage.getItem('theme') === 'system') { setTheme('system'); }
            });
        }
        document.addEventListener('DOMContentLoaded', () => {
            const switcher = document.getElementById('theme-switcher');
            if (switcher) {
                switcher.addEventListener('change', (e) => {
                    const newTheme = e.target.value;
                    localStorage.setItem('theme', newTheme);
                    setTheme(newTheme);
                });
            }
        });
        async function logout() {
            await supabaseClient.auth.signOut();
            window.location.href = "index.html";
        }
    </script>

    <script src="jadwal.js"></script>

    <script>
        window.addEventListener('load', applyTheme);
    </script>
</body>
</html>
