<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manajemen Jadwal Kuliah</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100">

  <div class="container mx-auto mt-8">
    <h1 class="text-3xl font-bold text-center mb-6">Manajemen Jadwal Kuliah</h1>

    <!-- Tombol Ekspor -->
    <div class="flex justify-center space-x-4 mb-4">
      <button onclick="exportExcel()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Export Excel</button>
      <button onclick="exportPDF()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Export PDF</button>
    </div>

    <!-- Tabel Jadwal -->
    <div class="overflow-x-auto bg-white rounded shadow">
      <table id="tabel-jadwal" class="min-w-full text-sm text-left text-gray-700">
        <thead class="bg-gray-800 text-white">
          <tr>
            <th class="px-4 py-2">No</th>
            <th class="px-4 py-2">Kode Matkul</th>
            <th class="px-4 py-2">Prodi</th>
            <th class="px-4 py-2">Hari</th>
            <th class="px-4 py-2">Jam Mulai</th>
            <th class="px-4 py-2">Jam Akhir</th>
            <th class="px-4 py-2">Mata Kuliah</th>
            <th class="px-4 py-2">SKS</th>
            <th class="px-4 py-2">Dosen</th>
            <th class="px-4 py-2">Asisten</th>
            <th class="px-4 py-2">Semester</th>
            <th class="px-4 py-2">Kelas</th>
            <th class="px-4 py-2">Ruangan</th>
          </tr>
        </thead>
        <tbody id="data-jadwal"></tbody>
      </table>
    </div>
  </div>

  <!-- Tambahkan sebelum penutup </body> -->
  <!-- Library jsPDF dan autoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <!-- Library XLSX untuk export Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    // ======== DATA & WARNA PRODI ========
    const prodiColors = {
      "Industri": { rgb: [255, 0, 0], ffill: "FFFF0000", font: "FFFFFFFF" },
      "Sipil": { rgb: [0, 0, 255], ffill: "FF0000FF", font: "FFFFFFFF" },
      "Arsitektur": { rgb: [0, 128, 0], ffill: "FF008000", font: "FFFFFFFF" },
      "Elektro": { rgb: [139, 69, 19], ffill: "FF8B4513", font: "FFFFFFFF" },
      "Informasi": { rgb: [255, 255, 0], ffill: "FFFFFF00", font: "FF000000" }
    };

    let dataYangDitampilkan = [
      { kode_matkul: "IND101", prodi: "Industri", hari: "Senin", jam_mulai: "08:00", jam_akhir: "10:00", mata_kuliah: "Manajemen Produksi", sks: 3, dosen: "Dr. Andi", asisten: "-", semester: 4, kelas: "A", ruangan: "R101" },
      { kode_matkul: "SIP201", prodi: "Sipil", hari: "Selasa", jam_mulai: "10:00", jam_akhir: "12:00", mata_kuliah: "Struktur Beton", sks: 3, dosen: "Ir. Budi", asisten: "-", semester: 5, kelas: "B", ruangan: "R202" },
      { kode_matkul: "ARS301", prodi: "Arsitektur", hari: "Rabu", jam_mulai: "13:00", jam_akhir: "15:00", mata_kuliah: "Desain Bangunan", sks: 3, dosen: "Dr. Citra", asisten: "-", semester: 6, kelas: "C", ruangan: "R303" },
      { kode_matkul: "ELK401", prodi: "Elektro", hari: "Kamis", jam_mulai: "09:00", jam_akhir: "11:00", mata_kuliah: "Sistem Digital", sks: 3, dosen: "Ir. Dedi", asisten: "-", semester: 5, kelas: "D", ruangan: "R404" },
      { kode_matkul: "INF501", prodi: "Informasi", hari: "Jumat", jam_mulai: "07:00", jam_akhir: "09:00", mata_kuliah: "Pemrograman Web", sks: 3, dosen: "Siti", asisten: "Rian", semester: 4, kelas: "E", ruangan: "R505" }
    ];

    // ======== RENDER TABEL ========
    const tbody = document.getElementById('data-jadwal');
    dataYangDitampilkan.forEach((item, i) => {
      const tr = document.createElement('tr');
      const warna = prodiColors[item.prodi] ? `background-color: rgb(${prodiColors[item.prodi].rgb.join(',')}); color: white;` : "";
      tr.innerHTML = `
        <td class="px-4 py-2">${i + 1}</td>
        <td class="px-4 py-2">${item.kode_matkul}</td>
        <td class="px-4 py-2" style="${warna}">${item.prodi}</td>
        <td class="px-4 py-2">${item.hari}</td>
        <td class="px-4 py-2">${item.jam_mulai}</td>
        <td class="px-4 py-2">${item.jam_akhir}</td>
        <td class="px-4 py-2">${item.mata_kuliah}</td>
        <td class="px-4 py-2">${item.sks}</td>
        <td class="px-4 py-2">${item.dosen}</td>
        <td class="px-4 py-2">${item.asisten}</td>
        <td class="px-4 py-2">${item.semester}</td>
        <td class="px-4 py-2">${item.kelas}</td>
        <td class="px-4 py-2">${item.ruangan}</td>
      `;
      tbody.appendChild(tr);
    });

    function showToast(msg) { alert(msg); }

    // ======== EXPORT EXCEL ========
    function exportExcel() {
      if (dataYangDitampilkan.length === 0) return showToast("Tidak ada data!");
      const header = [["No", "Kode Matkul", "Prodi", "Hari", "Jam Mulai", "Jam Akhir", "Mata Kuliah", "SKS", "Dosen", "Asisten", "Semester", "Kelas", "Ruangan"]];
      const body = dataYangDitampilkan.map((r, i) => [i + 1, r.kode_matkul, r.prodi, r.hari, r.jam_mulai, r.jam_akhir, r.mata_kuliah, r.sks, r.dosen, r.asisten, r.semester, r.kelas, r.ruangan]);
      const ws = XLSX.utils.aoa_to_sheet([...header, ...body]);
      const range = XLSX.utils.decode_range(ws['!ref']);
      for (let r = 1; r <= range.e.r; r++) {
        const c = 2; const addr = XLSX.utils.encode_cell({ c, r }); const cell = ws[addr]; if (!cell) continue;
        const color = prodiColors[cell.v]; if (color) cell.s = { fill: { fgColor: { rgb: color.ffill } }, font: { color: { rgb: color.font } } };
      }
      const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Jadwal Kuliah"); XLSX.writeFile(wb, "Jadwal_Kuliah.xlsx");
    }

    // ======== EXPORT PDF ========
    function exportPDF() {
      if (dataYangDitampilkan.length === 0) return showToast("Tidak ada data!");
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: 'landscape' });
      doc.text("Jadwal Kuliah", 14, 10);
      const tableData = dataYangDitampilkan.map((r, i) => [i + 1, r.kode_matkul, r.prodi, r.hari, r.jam_mulai, r.jam_akhir, r.mata_kuliah, r.sks, r.dosen, r.asisten, r.semester, r.kelas, r.ruangan]);
      doc.autoTable({
        head: [["No", "Kode Matkul", "Prodi", "Hari", "Jam Mulai", "Jam Akhir", "Mata Kuliah", "SKS", "Dosen", "Asisten", "Semester", "Kelas", "Ruangan"]],
        body: tableData,
        styles: { fontSize: 8 },
        didParseCell: data => {
          if (data.section === "body" && data.column.index === 2) {
            const color = prodiColors[data.cell.raw];
            if (color) data.cell.styles.fillColor = color.rgb;
          }
        }
      });
      doc.save("Jadwal_Kuliah.pdf");
    }
  </script>
</body>
</html>
